import { FollowupFile, FollowupFileFormData } from "./schema";

// Données de démonstration
const mockFollowupFiles: FollowupFile[] = [
    {
        id: "1",
        reference_number: "FU-2024-001",
        status: "Ouvert",
        vehicle_id: "V001",
        port_call_id: "PC-2024-001",
        created_at: "2024-01-15T08:00:00Z",
        updated_at: "2024-01-20T14:30:00Z",
        vehicle_info: {
            plate_number: "AB-123-CD",
            brand: "Toyota",
            model: "Camry",
            year: 2023,
        },
        documents: [
            {
                id: "doc1",
                name: "Connaissement Toyota Camry",
                type: "Connaissement",
                file_url: "/documents/connaissement-001.pdf",
                uploaded_at: "2024-01-15T08:30:00Z",
                uploaded_by: "John Doe",
                status: "Approuvé",
            },
        ],
        photos: [
            {
                id: "photo1",
                description: "État général du véhicule à l'arrivée",
                file_url: "/photos/vehicle-001-arrival.jpg",
                taken_at: "2024-01-15T09:00:00Z",
                taken_by: "John Doe",
                category: "État du véhicule",
            },
        ],
        workflow_steps: [
            {
                id: "step1",
                name: "Inspection initiale",
                description: "Vérification de l'état du véhicule à l'arrivée",
                status: "Terminé",
                assigned_to: "John Doe",
                started_at: "2024-01-15T09:00:00Z",
                completed_at: "2024-01-15T10:00:00Z",
                order: 1,
                is_required: true,
            },
            {
                id: "step2",
                name: "Placement au parking",
                description: "Transfert du véhicule vers la zone de stockage",
                status: "En cours",
                assigned_to: "Jane Smith",
                started_at: "2024-01-16T08:00:00Z",
                order: 2,
                is_required: true,
            },
        ],
        inspections: [
            {
                id: "insp1",
                type: "SURVEY",
                status: "Terminée",
                inspector: "John Doe",
                scheduled_at: "2024-01-15T09:00:00Z",
                started_at: "2024-01-15T09:00:00Z",
                completed_at: "2024-01-15T10:00:00Z",
                results: "Véhicule en bon état général",
                findings: ["Pneus en bon état", "Carrosserie sans dommage"],
                recommendations: ["Procéder au placement au parking"],
            },
        ],
        assigned_inspector: "John Doe",
        notes: "Véhicule en excellent état, traitement prioritaire",
        priority: "Élevée",
        estimated_completion_date: "2024-01-25T17:00:00Z",
    },
    {
        id: "2",
        reference_number: "FU-2024-002",
        status: "En attente",
        vehicle_id: "V002",
        port_call_id: "PC-2024-002",
        created_at: "2024-01-18T10:00:00Z",
        updated_at: "2024-01-18T10:00:00Z",
        vehicle_info: {
            plate_number: "XY-789-ZW",
            brand: "Honda",
            model: "Civic",
            year: 2022,
        },
        documents: [],
        photos: [],
        workflow_steps: [
            {
                id: "step3",
                name: "Inspection initiale",
                description: "Vérification de l'état du véhicule à l'arrivée",
                status: "En attente",
                order: 1,
                is_required: true,
            },
        ],
        inspections: [],
        priority: "Moyenne",
        estimated_completion_date: "2024-01-28T17:00:00Z",
    },
    {
        id: "3",
        reference_number: "FU-2024-003",
        status: "Fermé",
        vehicle_id: "V003",
        port_call_id: "PC-2024-003",
        created_at: "2024-01-10T08:00:00Z",
        updated_at: "2024-01-17T16:00:00Z",
        vehicle_info: {
            plate_number: "EF-456-GH",
            brand: "Ford",
            model: "Focus",
            year: 2021,
        },
        documents: [
            {
                id: "doc2",
                name: "Bon de sortie Ford Focus",
                type: "Bon de sortie",
                file_url: "/documents/bon-sortie-003.pdf",
                uploaded_at: "2024-01-17T15:00:00Z",
                uploaded_by: "Jane Smith",
                status: "Approuvé",
            },
        ],
        photos: [],
        workflow_steps: [
            {
                id: "step4",
                name: "Inspection initiale",
                description: "Vérification de l'état du véhicule à l'arrivée",
                status: "Terminé",
                assigned_to: "John Doe",
                started_at: "2024-01-10T09:00:00Z",
                completed_at: "2024-01-10T10:00:00Z",
                order: 1,
                is_required: true,
            },
            {
                id: "step5",
                name: "Autorisation de sortie",
                description: "Validation finale avant sortie du port",
                status: "Terminé",
                assigned_to: "Jane Smith",
                started_at: "2024-01-17T14:00:00Z",
                completed_at: "2024-01-17T15:00:00Z",
                order: 2,
                is_required: true,
            },
        ],
        inspections: [
            {
                id: "insp2",
                type: "SURVEY",
                status: "Terminée",
                inspector: "John Doe",
                scheduled_at: "2024-01-10T09:00:00Z",
                started_at: "2024-01-10T09:00:00Z",
                completed_at: "2024-01-10T10:00:00Z",
                results: "Véhicule conforme aux standards",
                findings: ["Tous les contrôles passés avec succès"],
                recommendations: ["Autoriser la sortie"],
            },
        ],
        assigned_inspector: "John Doe",
        notes: "Dossier traité avec succès, véhicule sorti du port",
        priority: "Faible",
        estimated_completion_date: "2024-01-20T17:00:00Z",
        actual_completion_date: "2024-01-17T16:00:00Z",
    },
    {
        id: "4",
        reference_number: "FU-2024-003",
        status: "Fermé",
        vehicle_id: "V003",
        port_call_id: "PC-2024-003",
        created_at: "2025-08-10T08:00:00Z",
        updated_at: "2024-01-17T16:00:00Z",
        vehicle_info: {
            plate_number: "EF-456-GH",
            brand: "Ford",
            model: "Focus",
            year: 2021,
        },
        documents: [
            {
                id: "doc2",
                name: "Bon de sortie Ford Focus",
                type: "Bon de sortie",
                file_url: "/documents/bon-sortie-003.pdf",
                uploaded_at: "2024-01-17T15:00:00Z",
                uploaded_by: "Jane Smith",
                status: "Approuvé",
            },
        ],
        photos: [],
        workflow_steps: [
            {
                id: "step4",
                name: "Inspection initiale",
                description: "Vérification de l'état du véhicule à l'arrivée",
                status: "Terminé",
                assigned_to: "John Doe",
                started_at: "2024-01-10T09:00:00Z",
                completed_at: "2024-01-10T10:00:00Z",
                order: 1,
                is_required: true,
            },
            {
                id: "step5",
                name: "Autorisation de sortie",
                description: "Validation finale avant sortie du port",
                status: "Terminé",
                assigned_to: "Jane Smith",
                started_at: "2024-01-17T14:00:00Z",
                completed_at: "2024-01-17T15:00:00Z",
                order: 2,
                is_required: true,
            },
        ],
        inspections: [
            {
                id: "insp2",
                type: "SURVEY",
                status: "Terminée",
                inspector: "John Doe",
                scheduled_at: "2024-01-10T09:00:00Z",
                started_at: "2024-01-10T09:00:00Z",
                completed_at: "2024-01-10T10:00:00Z",
                results: "Véhicule conforme aux standards",
                findings: ["Tous les contrôles passés avec succès"],
                recommendations: ["Autoriser la sortie"],
            },
        ],
        assigned_inspector: "John Doe",
        notes: "Dossier traité avec succès, véhicule sorti du port",
        priority: "Faible",
        estimated_completion_date: "2024-01-20T17:00:00Z",
        actual_completion_date: "2024-01-17T16:00:00Z",
    },
    {
        id: "4",
        reference_number: "FU-2024-003",
        status: "Fermé",
        vehicle_id: "V003",
        port_call_id: "PC-2024-003",
        created_at: "2024-01-10T08:00:00Z",
        updated_at: "2024-01-17T16:00:00Z",
        vehicle_info: {
            plate_number: "EF-456-GH",
            brand: "Ford",
            model: "Focus",
            year: 2021,
        },
        documents: [
            {
                id: "doc2",
                name: "Bon de sortie Ford Focus",
                type: "Bon de sortie",
                file_url: "/documents/bon-sortie-003.pdf",
                uploaded_at: "2024-01-17T15:00:00Z",
                uploaded_by: "Jane Smith",
                status: "Approuvé",
            },
        ],
        photos: [],
        workflow_steps: [
            {
                id: "step4",
                name: "Inspection initiale",
                description: "Vérification de l'état du véhicule à l'arrivée",
                status: "Terminé",
                assigned_to: "John Doe",
                started_at: "2024-01-10T09:00:00Z",
                completed_at: "2024-01-10T10:00:00Z",
                order: 1,
                is_required: true,
            },
            {
                id: "step5",
                name: "Autorisation de sortie",
                description: "Validation finale avant sortie du port",
                status: "Terminé",
                assigned_to: "Jane Smith",
                started_at: "2024-01-17T14:00:00Z",
                completed_at: "2024-01-17T15:00:00Z",
                order: 2,
                is_required: true,
            },
        ],
        inspections: [
            {
                id: "insp2",
                type: "SURVEY",
                status: "Terminée",
                inspector: "John Doe",
                scheduled_at: "2024-01-10T09:00:00Z",
                started_at: "2024-01-10T09:00:00Z",
                completed_at: "2024-01-10T10:00:00Z",
                results: "Véhicule conforme aux standards",
                findings: ["Tous les contrôles passés avec succès"],
                recommendations: ["Autoriser la sortie"],
            },
        ],
        assigned_inspector: "John Doe",
        notes: "Dossier traité avec succès, véhicule sorti du port",
        priority: "Faible",
        estimated_completion_date: "2024-01-20T17:00:00Z",
        actual_completion_date: "2024-01-17T16:00:00Z",
    },
    {
        id: "4",
        reference_number: "FU-2024-003",
        status: "Fermé",
        vehicle_id: "V003",
        port_call_id: "PC-2024-003",
        created_at: "2024-01-10T08:00:00Z",
        updated_at: "2024-01-17T16:00:00Z",
        vehicle_info: {
            plate_number: "EF-456-GH",
            brand: "Ford",
            model: "Focus",
            year: 2021,
        },
        documents: [
            {
                id: "doc2",
                name: "Bon de sortie Ford Focus",
                type: "Bon de sortie",
                file_url: "/documents/bon-sortie-003.pdf",
                uploaded_at: "2024-01-17T15:00:00Z",
                uploaded_by: "Jane Smith",
                status: "Approuvé",
            },
        ],
        photos: [],
        workflow_steps: [
            {
                id: "step4",
                name: "Inspection initiale",
                description: "Vérification de l'état du véhicule à l'arrivée",
                status: "Terminé",
                assigned_to: "John Doe",
                started_at: "2024-01-10T09:00:00Z",
                completed_at: "2024-01-10T10:00:00Z",
                order: 1,
                is_required: true,
            },
            {
                id: "step5",
                name: "Autorisation de sortie",
                description: "Validation finale avant sortie du port",
                status: "Terminé",
                assigned_to: "Jane Smith",
                started_at: "2024-01-17T14:00:00Z",
                completed_at: "2024-01-17T15:00:00Z",
                order: 2,
                is_required: true,
            },
        ],
        inspections: [
            {
                id: "insp2",
                type: "SURVEY",
                status: "Terminée",
                inspector: "John Doe",
                scheduled_at: "2024-01-10T09:00:00Z",
                started_at: "2024-01-10T09:00:00Z",
                completed_at: "2024-01-10T10:00:00Z",
                results: "Véhicule conforme aux standards",
                findings: ["Tous les contrôles passés avec succès"],
                recommendations: ["Autoriser la sortie"],
            },
        ],
        assigned_inspector: "John Doe",
        notes: "Dossier traité avec succès, véhicule sorti du port",
        priority: "Faible",
        estimated_completion_date: "2024-01-20T17:00:00Z",
        actual_completion_date: "2024-01-17T16:00:00Z",
    },
    {
        id: "4",
        reference_number: "FU-2024-003",
        status: "Fermé",
        vehicle_id: "V003",
        port_call_id: "PC-2024-003",
        created_at: "2024-01-10T08:00:00Z",
        updated_at: "2024-01-17T16:00:00Z",
        vehicle_info: {
            plate_number: "EF-456-GH",
            brand: "Ford",
            model: "Focus",
            year: 2021,
        },
        documents: [
            {
                id: "doc2",
                name: "Bon de sortie Ford Focus",
                type: "Bon de sortie",
                file_url: "/documents/bon-sortie-003.pdf",
                uploaded_at: "2024-01-17T15:00:00Z",
                uploaded_by: "Jane Smith",
                status: "Approuvé",
            },
        ],
        photos: [],
        workflow_steps: [
            {
                id: "step4",
                name: "Inspection initiale",
                description: "Vérification de l'état du véhicule à l'arrivée",
                status: "Terminé",
                assigned_to: "John Doe",
                started_at: "2024-01-10T09:00:00Z",
                completed_at: "2024-01-10T10:00:00Z",
                order: 1,
                is_required: true,
            },
            {
                id: "step5",
                name: "Autorisation de sortie",
                description: "Validation finale avant sortie du port",
                status: "Terminé",
                assigned_to: "Jane Smith",
                started_at: "2024-01-17T14:00:00Z",
                completed_at: "2024-01-17T15:00:00Z",
                order: 2,
                is_required: true,
            },
        ],
        inspections: [
            {
                id: "insp2",
                type: "SURVEY",
                status: "Terminée",
                inspector: "John Doe",
                scheduled_at: "2024-01-10T09:00:00Z",
                started_at: "2024-01-10T09:00:00Z",
                completed_at: "2024-01-10T10:00:00Z",
                results: "Véhicule conforme aux standards",
                findings: ["Tous les contrôles passés avec succès"],
                recommendations: ["Autoriser la sortie"],
            },
        ],
        assigned_inspector: "John Doe",
        notes: "Dossier traité avec succès, véhicule sorti du port",
        priority: "Faible",
        estimated_completion_date: "2024-01-20T17:00:00Z",
        actual_completion_date: "2024-01-17T16:00:00Z",
    },
    {
        id: "4",
        reference_number: "FU-2024-003",
        status: "Fermé",
        vehicle_id: "V003",
        port_call_id: "PC-2024-003",
        created_at: "2024-01-10T08:00:00Z",
        updated_at: "2024-01-17T16:00:00Z",
        vehicle_info: {
            plate_number: "EF-456-GH",
            brand: "Ford",
            model: "Focus",
            year: 2021,
        },
        documents: [
            {
                id: "doc2",
                name: "Bon de sortie Ford Focus",
                type: "Bon de sortie",
                file_url: "/documents/bon-sortie-003.pdf",
                uploaded_at: "2024-01-17T15:00:00Z",
                uploaded_by: "Jane Smith",
                status: "Approuvé",
            },
        ],
        photos: [],
        workflow_steps: [
            {
                id: "step4",
                name: "Inspection initiale",
                description: "Vérification de l'état du véhicule à l'arrivée",
                status: "Terminé",
                assigned_to: "John Doe",
                started_at: "2024-01-10T09:00:00Z",
                completed_at: "2024-01-10T10:00:00Z",
                order: 1,
                is_required: true,
            },
            {
                id: "step5",
                name: "Autorisation de sortie",
                description: "Validation finale avant sortie du port",
                status: "Terminé",
                assigned_to: "Jane Smith",
                started_at: "2024-01-17T14:00:00Z",
                completed_at: "2024-01-17T15:00:00Z",
                order: 2,
                is_required: true,
            },
        ],
        inspections: [
            {
                id: "insp2",
                type: "SURVEY",
                status: "Terminée",
                inspector: "John Doe",
                scheduled_at: "2024-01-10T09:00:00Z",
                started_at: "2024-01-10T09:00:00Z",
                completed_at: "2024-01-10T10:00:00Z",
                results: "Véhicule conforme aux standards",
                findings: ["Tous les contrôles passés avec succès"],
                recommendations: ["Autoriser la sortie"],
            },
        ],
        assigned_inspector: "John Doe",
        notes: "Dossier traité avec succès, véhicule sorti du port",
        priority: "Faible",
        estimated_completion_date: "2024-01-20T17:00:00Z",
        actual_completion_date: "2024-01-17T16:00:00Z",
    },
    {
        id: "4",
        reference_number: "FU-2024-003",
        status: "Fermé",
        vehicle_id: "V003",
        port_call_id: "PC-2024-003",
        created_at: "2024-01-10T08:00:00Z",
        updated_at: "2024-01-17T16:00:00Z",
        vehicle_info: {
            plate_number: "EF-456-GH",
            brand: "Ford",
            model: "Focus",
            year: 2021,
        },
        documents: [
            {
                id: "doc2",
                name: "Bon de sortie Ford Focus",
                type: "Bon de sortie",
                file_url: "/documents/bon-sortie-003.pdf",
                uploaded_at: "2024-01-17T15:00:00Z",
                uploaded_by: "Jane Smith",
                status: "Approuvé",
            },
        ],
        photos: [],
        workflow_steps: [
            {
                id: "step4",
                name: "Inspection initiale",
                description: "Vérification de l'état du véhicule à l'arrivée",
                status: "Terminé",
                assigned_to: "John Doe",
                started_at: "2024-01-10T09:00:00Z",
                completed_at: "2024-01-10T10:00:00Z",
                order: 1,
                is_required: true,
            },
            {
                id: "step5",
                name: "Autorisation de sortie",
                description: "Validation finale avant sortie du port",
                status: "Terminé",
                assigned_to: "Jane Smith",
                started_at: "2024-01-17T14:00:00Z",
                completed_at: "2024-01-17T15:00:00Z",
                order: 2,
                is_required: true,
            },
        ],
        inspections: [
            {
                id: "insp2",
                type: "SURVEY",
                status: "Terminée",
                inspector: "John Doe",
                scheduled_at: "2024-01-10T09:00:00Z",
                started_at: "2024-01-10T09:00:00Z",
                completed_at: "2024-01-10T10:00:00Z",
                results: "Véhicule conforme aux standards",
                findings: ["Tous les contrôles passés avec succès"],
                recommendations: ["Autoriser la sortie"],
            },
        ],
        assigned_inspector: "John Doe",
        notes: "Dossier traité avec succès, véhicule sorti du port",
        priority: "Faible",
        estimated_completion_date: "2024-01-20T17:00:00Z",
        actual_completion_date: "2024-01-17T16:00:00Z",
    },
];

export const fetchFollowupFiles = async (): Promise<FollowupFile[]> => {
    // Simulation d'un appel API
    await new Promise((resolve) => setTimeout(resolve, 1000));
    return mockFollowupFiles;
};

export const createFollowupFile = async (
    data: FollowupFileFormData
): Promise<FollowupFile> => {
    // Simulation d'un appel API
    await new Promise((resolve) => setTimeout(resolve, 500));

    const newFile: FollowupFile = {
        id: Date.now().toString(),
        reference_number: data.reference_number,
        status: "Ouvert",
        vehicle_id: data.vehicle_id,
        port_call_id: data.port_call_id,
        created_at: new Date().toISOString(),
        updated_at: new Date().toISOString(),
        documents: [],
        photos: [],
        workflow_steps: [
            {
                id: "step-" + Date.now(),
                name: "Inspection initiale",
                description: "Vérification de l'état du véhicule à l'arrivée",
                status: "En attente",
                order: 1,
                is_required: true,
            },
        ],
        inspections: [],
        assigned_inspector: data.assigned_inspector,
        notes: data.notes,
        priority: data.priority,
        estimated_completion_date: data.estimated_completion_date,
    };

    mockFollowupFiles.push(newFile);
    return newFile;
};

export const updateFollowupFile = async (
    id: string,
    data: Partial<FollowupFile>
): Promise<FollowupFile> => {
    // Simulation d'un appel API
    await new Promise((resolve) => setTimeout(resolve, 500));

    const index = mockFollowupFiles.findIndex((file) => file.id === id);
    if (index === -1) {
        throw new Error("Dossier de suivi non trouvé");
    }

    mockFollowupFiles[index] = {
        ...mockFollowupFiles[index],
        ...data,
        updated_at: new Date().toISOString(),
    };

    return mockFollowupFiles[index];
};

export const deleteFollowupFile = async (id: string): Promise<void> => {
    // Simulation d'un appel API
    await new Promise((resolve) => setTimeout(resolve, 500));

    const index = mockFollowupFiles.findIndex((file) => file.id === id);
    if (index === -1) {
        throw new Error("Dossier de suivi non trouvé");
    }

    mockFollowupFiles.splice(index, 1);
};
